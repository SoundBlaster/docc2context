# F7 Rich Inline Source Documentation

**Status:** Selected (planning)  
**Owner:** docc2context agent  
**Selected on:** 2025-12-18  
**PRD reference:** `DOCS/PRD/docc2context_prd.md` §5 (F7)  
**Workplan reference:** `DOCS/workplan.md` (Phase F, F7)  
**Related archives:** `DOCS/TASK_ARCHIVE/51_F4_DogfoodDocCFixtureFromSources/`, `DOCS/TASK_ARCHIVE/52_F5_XcodeParitySymbolPageRendering/`, `DOCS/TASK_ARCHIVE/50_F6_SinglePageSymbolMarkdownMode/`

## Objective
Improve the “real” DocC content for this project by adding rich DocC documentation comments inline in `Sources/` for the public API surface, then regenerating the committed DocC fixture (`Fixtures/Docc2contextCore.doccarchive`) and updating impacted Markdown snapshots deterministically.

## Why now
- We already dogfood Swift-DocC render archives (F4/F5) and users want Xcode-like symbol docs; richer inline docs improves both Xcode browsing and the fidelity of fixture-driven Markdown exports.
- The fixture is already committed and validated by manifest hashing; we can evolve it safely via pinned provenance and snapshot updates.

## Scope (what START should deliver)
1. **Rich public DocC comments in `Sources/`**
   - Target key entry points first (public surface area):
     - `Docc2contextCommand` / CLI options + help
     - `MarkdownGenerationPipeline`
     - `DoccMetadataParser`
     - `DoccMarkdownRenderer`
     - Symbol/article/tutorial models that appear in output
   - Add summary + discussion text that matches Xcode expectations (not just autogenerated structure).
   - Add at least one small “Usage” example that is offline-friendly and deterministic.
2. **Regenerate fixture + update manifest**
   - Regenerate `Fixtures/Docc2contextCore.doccarchive` under pinned provenance (`swift package generate-documentation`).
   - Update `Fixtures/manifest.json` hash/size entries as required.
   - Keep the fixture small and pruned consistently (avoid adding non-deterministic assets).
3. **Update snapshots impacted by new DocC content**
   - Update any Markdown snapshots whose rendered content changes (e.g. symbol page snapshots).
   - Ensure determinism remains byte-identical across repeated runs.

## Non-goals
- Expanding CLI surface area (unless required by new examples or docs).
- Generating DocC during `swift test` (tests must keep using committed fixtures only).

## Risks / constraints
- Toolchain drift: DocC output can change between Swift toolchains; provenance must be recorded and regeneration should be intentional.
- Output churn: richer docs will legitimately change Markdown snapshots; keep the change set scoped and validated.
- Determinism: avoid host-path leakage or timestamps in fixture outputs; keep pruning rules consistent.

## Validation plan (START)
- `python3 Scripts/validate_fixtures_manifest.py Fixtures/manifest.json`
- `swift test` (full suite; update snapshots as needed)
- `python3 Scripts/lint_markdown.py`

## Proposed execution steps (for START)
1. Identify the highest-value public symbols missing useful DocC content (start with pipeline + CLI).
2. Add DocC comments inline (summary + discussion + minimal usage example).
3. Regenerate and prune `Fixtures/Docc2contextCore.doccarchive` consistently; update `Fixtures/manifest.json`.
4. Re-run conversion tests; update snapshots under `Tests/__Snapshots__/` as required.
5. Validate determinism and commit.

## Implemented (START)
- Added richer DocC comments for key public types (`MarkdownGenerationPipeline`, `Docc2contextCommand`, `DoccMetadataParser`, `DoccMarkdownRenderer`, `BenchmarkComparator`), including deterministic usage examples.
- Extended Swift-DocC render-archive parsing for symbol pages to:
  - decode render-archive `abstract` inline content (including `codeVoice`) into stable Markdown text,
  - render `primaryContentSections` (content + parameters) into a `## Discussion` section,
  - fall back to a lossy JSON decode path so schema drift in render nodes doesn’t silently drop top-level symbol pages.
- Regenerated and pruned `Fixtures/Docc2contextCore.doccarchive` (kept `metadata.json` + `data/documentation/`), updated `Fixtures/manifest.json`, and refreshed affected snapshots.

## Validation evidence
- `swift test`
- `python3 Scripts/validate_fixtures_manifest.py Fixtures/manifest.json`
- `python3 Scripts/lint_markdown.py`
